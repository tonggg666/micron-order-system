<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¦ Micron Project è®¢è´§ç®¡ç†ç³»ç»Ÿ</title>
    
    <style>
        /* ======================================================= */
        /* === â€œå°æ¸…æ–°é«˜çº§â€æ·¡ç»¿è‰² UI æ ·å¼ (æœ€ç»ˆå®Œç¾ç‰ˆ) === */
        /* ======================================================= */

        /* é¢œè‰²å®šä¹‰ */
        :root {
            --color-base: #F7FFF7; /* ææµ…æ·¡ç»¿èƒŒæ™¯ */
            --color-light: #E8F5E9; /* è¡¨æ ¼/æ ‡ç­¾æµ…ç»¿èƒŒæ™¯ */
            --color-accent: #4CAF50; /* å¼ºè°ƒç»¿ (æŒ‰é’®ã€ç„¦ç‚¹) */
            --color-dark: #2E8B57; /* æ·±ç»¿ (è¡¨å¤´ã€æ ‡é¢˜çº¿) */
            --color-text: #333333; /* æ ‡å‡†æ–‡å­—é¢œè‰² */
            --color-red: #c0392b; 
            --color-border: #b3cbb6; /* ç»Ÿä¸€è¡¨æ ¼è¾¹æ¡†é¢œè‰² */
        }

        /* 1. åŸºç¡€ä¸å¸ƒå±€ - æ·¡ç»¿è‰²åŸºè°ƒ + Arial å­—ä½“ */
        body { 
            font-family: 'Arial', 'Microsoft YaHei', sans-serif; /* å­—ä½“æ”¹ä¸º Arial */
            margin: 0;
            padding: 20px;
            background-color: var(--color-base); 
            color: var(--color-text);
            line-height: 1.6;
        }

        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); 
            border: 1px solid #e0e0e0;
        }

        /* 2. æ ‡é¢˜ - å±…ä¸­æ˜¾ç¤º */
        h1 { 
            font-size: 28px;
            color: var(--color-dark);
            border-bottom: 3px solid var(--color-light); 
            padding-bottom: 8px; 
            margin-bottom: 25px; 
            font-weight: 700;
            text-align: center; /* æ ‡é¢˜å±…ä¸­ */
        }

        h2 { 
            font-size: 16px;
            color: var(--color-dark);
            border-bottom: 1px solid var(--color-light); 
            padding-bottom: 4px; 
            margin-top: 25px;
            margin-bottom: 15px; 
            font-weight: 600;
        }

        section { 
            margin-bottom: 25px; 
            padding: 15px; 
            border: 1px solid var(--color-light); 
            background-color: white; 
            border-radius: 4px;
        }
        
        /* 3. è¾“å…¥æ¡†å’ŒæŒ‰é’® */
        input[type="text"], input[type="number"], input[type="date"], button, select { 
            padding: 8px 10px; 
            border-radius: 4px; 
            border: 1px solid #ccc; 
            transition: border-color 0.2s;
            font-size: 13px;
            font-family: 'Arial', sans-serif; /* ç¡®ä¿è¾“å…¥æ¡†ä¹Ÿä½¿ç”¨ Arial */
        }
        
        input:focus, select:focus {
            border-color: var(--color-accent); 
            box-shadow: 0 0 0 1px rgba(76, 175, 80, 0.3); 
            outline: none;
        }
        
        /* æŒ‰é’®ä½¿ç”¨é«˜çº§ç»¿ */
        button { 
            cursor: pointer; 
            background-color: var(--color-accent); 
            color: white; 
            margin-right: 8px; 
            font-weight: 500;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        button:hover {
            background-color: #388E3C; 
        }
        
        button.red { 
            background-color: var(--color-red); 
        }

        /* 4. è¡¨æ ¼ - æ¸…æ™°è¾¹æ¡†å’Œæ·¡ç»¿è¡¨å¤´ï¼Œæ ‡é¢˜ç²—ä½“ */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 15px; 
            font-size: 13px;
        }

        th, td { 
            border: 1px solid var(--color-border); /* ç»Ÿä¸€è¡¨æ ¼è¾¹æ¡†é¢œè‰² */
            padding: 8px; 
            text-align: center; 
        }

        /* è¡¨å¤´æ ·å¼ï¼šæ·¡ç»¿èƒŒæ™¯ + ç²—ä½“ */
        th { 
            background-color: var(--color-light); 
            color: var(--color-dark);
            font-weight: bold; /* è¡¨æ ¼æ ‡é¢˜ç²—ä½“ */
        }

        /* å¥‡å¶è¡ŒèƒŒæ™¯è‰²ï¼Œä¿æŒæç®€ç™½ */
        #orderTableBody tr:nth-child(even), #editTableBody tr:nth-child(even) {
            background-color: var(--color-base);
        }
        
        /* 5. è”æƒ³è¾“å…¥æ ·å¼ */
        .autocomplete-list { 
            border: 1px solid var(--color-light); 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        .autocomplete-list li:hover { 
            background-color: var(--color-light); 
        }

        /* 6. æ¨¡æ€æ¡†æ ·å¼ - é€‚é… Image 1 é£æ ¼ */
        .modal { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0,0,0,0.4); 
            display: none; 
            justify-content: center; 
            align-items: center; 
            z-index: 2000; 
        }
        .modal-content { 
            background-color: #fff; 
            padding: 20px 30px; /* è°ƒæ•´å†…è¾¹è· */
            border-radius: 8px; 
            width: 90%; 
            max-width: 900px; 
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
            position: relative; 
        }
        .modal-content h2 {
            font-size: 20px; /* æ¨¡æ€æ¡†æ ‡é¢˜ç¨å¤§ */
            color: var(--color-dark);
            border-bottom: 2px solid var(--color-light);
            padding-bottom: 5px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .close-button { 
            color: #777; /* å…³é—­æŒ‰é’®é¢œè‰² */
            position: absolute; 
            top: 10px;
            right: 15px;
            font-size: 30px; 
            font-weight: normal; /* æ›´æŸ”å’Œçš„å…³é—­æŒ‰é’® */
            cursor: pointer;
        }
        .close-button:hover {
            color: #333;
        }

        /* æ¨¡æ€æ¡†å†…çš„è¡¨æ ¼æ ·å¼è°ƒæ•´ */
        #editTable th, #editTable td {
            padding: 6px; /* å‡å°å†…è¾¹è· */
            border: 1px solid #dcdcdc; /* æ›´æµ…çš„è¾¹æ¡† */
        }
        #editTable th {
            background-color: #f0f8f0; /* æ¨¡æ€æ¡†å†…è¡¨æ ¼è¡¨å¤´æ›´æµ…çš„èƒŒæ™¯ */
            color: var(--color-dark);
        }
        #editTable input {
            padding: 4px 6px; /* æ¨¡æ€æ¡†å†…è¾“å…¥æ¡†å†…è¾¹è· */
            font-size: 12px;
            width: calc(100% - 12px); /* é€‚åº”å®½åº¦ */
        }
        .image-preview {
            max-width: 30px; /* æ¨¡æ€æ¡†å†…å›¾ç‰‡é¢„è§ˆå¤§å° */
            max-height: 30px;
            vertical-align: middle;
            cursor: pointer;
        }

        /* 7. ç‰¹æ®ŠæŒ‰é’®å¼ºè°ƒ */
        .big-green-button {
            background-color: var(--color-accent) !important;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3) !important;
            font-size: 16px; /* ç¨å¤§å­—ä½“ */
            padding: 12px 25px; /* å¢å¤§ç‚¹å‡»åŒºåŸŸ */
        }
        
        .big-green-button:hover {
            background-color: #388E3C !important;
        }
        
        /* 8. è®¢è´§æ¦‚è§ˆä¿¡æ¯ */
        .header-info-table td {
            border: 1px solid var(--color-border); 
        }
        .header-info-table .info-label {
            background-color: var(--color-light); 
            color: var(--color-dark);
            font-weight: bold; /* ä¿¡æ¯è¡¨æ ¼æ ‡ç­¾ç²—ä½“ */
        }
        .header-info-table input {
            border: 1px solid #ccc;
            width: calc(100% - 10px); /* é€‚åº”è¡¨æ ¼å•å…ƒæ ¼ */
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“¦ Micron Project è®¢è´§ç®¡ç†ç³»ç»Ÿ</h1>

    <section id="header-info">
        <h2>ğŸ“ è®¢è´§æ¦‚è§ˆä¿¡æ¯</h2>
        <table class="header-info-table">
            <tr>
                <td class="info-label">PROJECT:</td>
                <td class="info-value">MICRON | FAB</td>
                <td class="info-label">REQUESTED BY è®¢è´§äºº:</td>
                <td class="info-value">SHEN FEI</td>
            </tr>
            <tr>
                <td class="info-label">CONTACT NO è”ç³»æ–¹å¼:</td>
                <td class="info-value">8452 1908</td>
                <td class="info-label">CONTACT PERSON è”ç³»äºº:</td>
                <td class="info-value">SHEN FEI (8452 1908)</td>
            </tr>
            <tr>
                <td class="info-label">REQUESTED DATE è®¢è´§æ—¥æœŸ:</td>
                <td class="info-value">
                    <input type="date" id="requestDate" required>
                </td>
                <td class="info-label">DELIVERY DATE é€è´§æ—¥æœŸ:</td>
                <td class="info-value">
                    <input type="date" id="deliveryDate" required>
                </td>
            </tr>
        </table>
    </section>

    <section id="master-data">
        <h2>ğŸ“¥ ç‰©å“å½•å…¥ç³»ç»Ÿ</h2>
        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center;">
            <input id="newItemName" placeholder="ç‰©å“åç§°/è¯¦æƒ… (å¿…å¡«)" style="flex: 3;">
            <input id="newItemUnit" placeholder="å•ä½ (å¿…å¡«: ç‰‡, ä¸ª, ç®±)" style="flex: 1;">
            <input id="newItemSize" placeholder="å¤§å° (SIZE)" style="flex: 1;">
            <input id="newItemTextRemark" placeholder="REMARK æ–‡æœ¬å¤‡æ³¨" style="flex: 2;">
            
            <div style="flex: 2; display: flex; align-items: center;">
                <label for="newItemImage" style="white-space: nowrap; font-size: 14px; margin-right: 5px;">è¯¦æƒ…ç…§ç‰‡:</label>
                <input type="file" id="newItemImage" accept="image/*" style="flex-grow: 1;">
            </div>
        </div>
        
        <div style="margin-top: 15px;">
            <button onclick="addItemToMaster()">å½•å…¥æ–°ç‰©å“åˆ°ç³»ç»Ÿ</button>
            <button onclick="viewMasterItemsModal()" style="background-color: #6c757d;">æŸ¥çœ‹/ç¼–è¾‘å·²å½•å…¥ç‰©å“åˆ—è¡¨</button>
            <button onclick="downloadMasterListAsWord()" style="background-color: #17a2b8;">ä¸‹è½½å®Œæ•´ç‰©å“å¯¹ç…§è¡¨ (Word)</button> 
        </div>
    </section>

    <section id="order-form">
        <h2>ğŸ›’ å®é™…è®¢è´§é¡µé¢</h2>
        <table id="orderTable">
            <thead>
                <tr>
                    <th style="width: 5%;">S/N åºå·</th>
                    <th style="width: 35%;">ITEMS/DESCRIPTION ç‰©å“/è¯¦æƒ… (è”æƒ³è¾“å…¥)</th>
                    <th style="width: 10%;">QTY æ•°é‡</th>
                    <th style="width: 10%;">UNIT å•ä½ (è‡ªåŠ¨)</th>
                    <th style="width: 10%;">SIZE å¤§å°</th>
                    <th style="width: 20%;">REMARK è¯¦æƒ…ç…§ç‰‡ (è‡ªåŠ¨)</th>
                    <th style="width: 10%;">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="orderTableBody">
                </tbody>
        </table>

        <button onclick="addRow()" style="margin-top: 20px;">+ å¢åŠ æ›´å¤šç‰©å“</button>
    </section>

    <div style="text-align: center; margin-top: 30px;">
        <button onclick="generateWord()" class="big-green-button">
            ğŸ“„ ä¸€é”®ç”Ÿæˆè®¢è´§å• WORD (.doc)
        </button>
        <p style="margin-top: 15px; color: #777; font-size: 13px;">
            **æç¤º:** ä¸‹è½½åæ‰“å¼€ Word è‹¥æç¤ºâ€œå—ä¿æŠ¤çš„è§†å›¾â€ï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹é»„æ¡çš„ <b>[å¯ç”¨ç¼–è¾‘]</b>ï¼Œå›¾ç‰‡æ‰ä¼šæ˜¾ç¤ºã€‚<br>
           </p>
    </div>
</div>

<div id="masterItemsModal" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="closeMasterItemsModal()">&times;</span>
        <h2>ğŸ“¦ ç‰©å“åº“åˆ—è¡¨</h2> <table id="editTable" style="width: 100%;">
            <thead>
                <tr>
                    <th style="width: 5%;">åºå·</th>
                    <th style="width: 30%;">ç‰©å“åç§°/è¯¦æƒ…</th>
                    <th style="width: 10%;">å•ä½</th>
                    <th style="width: 10%;">å¤§å°</th>
                    <th style="width: 20%;">æ–‡æœ¬å¤‡æ³¨</th>
                    <th style="width: 10%;">å›¾ç‰‡</th>
                    <th style="width: 15%;">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="editTableBody">
                </tbody>
        </table>
        <div style="text-align: right; margin-top: 20px;"> <button onclick="saveMasterItemsEdit()" style="background-color: var(--color-accent);">ä¿å­˜æ›´æ”¹</button>
        </div>
    </div>
</div>


<script>
    // --- æ¨¡æ‹Ÿæ•°æ®å’Œå¸¸é‡ ---
    const CONTACT_INFO = { REQUESTED_BY: 'SHEN FEI', CONTACT_NO: '8452 1908' };
    const STORAGE_KEY = 'micron_project_items_js';

    const initialItems = [
      { name: 'ç°è‰²å®‰å…¨ç½‘', unit: 'ç‰‡', size: '', textRemark: 'æ— ', base64Image: '' },
      { name: '2M å¸ƒå¸¦(3T)', unit: 'æ¡', size: '3T', textRemark: 'ç¤ºæ„å›¾:å¸ƒå¸¦', base64Image: '' },
      { name: 'å¯¹è®²æœº', unit: 'ä¸ª', size: '', textRemark: 'æ— ', base64Image: '' },
    ];

    // --- å…¨å±€çŠ¶æ€ ---
    let masterItems = [];
    let orderList = [];
    let currentBase64 = ''; 

    // --- åˆå§‹åŒ–å’ŒåŠ è½½ ---

    function init() {
        // åˆå§‹åŒ–è®¢è´§æ¦‚è§ˆä¿¡æ¯ (JSä»£ç è¿˜åŸHTMLä¸­çš„è¡¨æ ¼ç»“æ„)
        document.querySelector('.header-info-table').innerHTML = `
            <tr>
                <td class="info-label">PROJECT:</td>
                <td class="info-value">MICRON | FAB</td>
                <td class="info-label">REQUESTED BY è®¢è´§äºº:</td>
                <td class="info-value">${CONTACT_INFO.REQUESTED_BY}</td>
            </tr>
            <tr>
                <td class="info-label">CONTACT NO è”ç³»æ–¹å¼:</td>
                <td class="info-value">${CONTACT_INFO.CONTACT_NO}</td>
                <td class="info-label">CONTACT PERSON è”ç³»äºº:</td>
                <td class="info-value">${CONTACT_INFO.REQUESTED_BY} (${CONTACT_INFO.CONTACT_NO})</td>
            </tr>
            <tr>
                <td class="info-label">REQUESTED DATE è®¢è´§æ—¥æœŸ:</td>
                <td class="info-value">
                    <input type="date" id="requestDate" required>
                </td>
                <td class="info-label">DELIVERY DATE é€è´§æ—¥æœŸ:</td>
                <td class="info-value">
                    <input type="date" id="deliveryDate" required>
                </td>
            </tr>
        `;


        const today = new Date().toISOString().split('T')[0];
        document.getElementById('requestDate').value = today;

        const storedItems = localStorage.getItem(STORAGE_KEY);
        if (storedItems) {
            masterItems = JSON.parse(storedItems);
             // å…¼å®¹æ€§æ¸…ç†
             masterItems = masterItems.map(item => { delete item.subject; return item; });
        } else {
            masterItems = initialItems;
        }
        localStorage.setItem(STORAGE_KEY, JSON.stringify(masterItems));

        if (orderList.length === 0) {
            addRow(); 
        }
        document.getElementById('newItemImage').addEventListener('change', handleImageUpload);
    }

    // --- å›¾ç‰‡ä¸Šä¼ å¤„ç† ---
    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                currentBase64 = e.target.result;
                alert('å›¾ç‰‡å·²åŠ è½½åˆ°å†…å­˜ï¼Œç­‰å¾…å½•å…¥ç‰©å“ã€‚');
            };
            reader.readAsDataURL(file);
        }
    }


    // --- 2. ç‰©å“å½•å…¥åŠŸèƒ½ ---

    function addItemToMaster() {
        const name = document.getElementById('newItemName').value.trim();
        const unit = document.getElementById('newItemUnit').value.trim();
        const size = document.getElementById('newItemSize').value.trim();
        const textRemark = document.getElementById('newItemTextRemark').value.trim(); 

        if (!name || !unit) {
            alert('è¯·è¾“å…¥ç‰©å“åç§°å’Œå•ä½ï¼');
            return;
        }

        const newMasterItem = { 
            name, 
            unit, 
            size, 
            textRemark, 
            base64Image: currentBase64 
        };
        masterItems.push(newMasterItem);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(masterItems));
        
        // æ¸…ç©ºè¾“å…¥
        document.getElementById('newItemName').value = '';
        document.getElementById('newItemUnit').value = '';
        document.getElementById('newItemSize').value = '';
        document.getElementById('newItemTextRemark').value = '';
        document.getElementById('newItemImage').value = '';
        currentBase64 = '';

        alert(`ç‰©å“ "${name}" å½•å…¥æˆåŠŸï¼${newMasterItem.base64Image ? '(åŒ…å«å›¾ç‰‡)' : '(æ— å›¾ç‰‡)'}`);
    }

    // --- 3. ç‰©å“æŸ¥çœ‹/ç¼–è¾‘æ¨¡æ€æ¡†åŠŸèƒ½ (å·²ä¿®å¤) ---
    
    function viewMasterItemsModal() {
        renderEditTable();
        document.getElementById('masterItemsModal').style.display = 'flex'; // ä½¿ç”¨ flex å±…ä¸­
    }

    function closeMasterItemsModal() {
        document.getElementById('masterItemsModal').style.display = 'none';
    }

    function renderEditTable() {
        const tbody = document.getElementById('editTableBody');
        tbody.innerHTML = '';

        if (masterItems.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7">ç³»ç»Ÿæš‚æ— å·²å½•å…¥ç‰©å“ã€‚</td></tr>';
            return;
        }

        masterItems.forEach((item, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${index + 1}</td>
                <td><input type="text" value="${item.name}" data-index="${index}" data-field="name" onchange="handleMasterEdit(this)" style="width: 95%;"></td>
                <td><input type="text" value="${item.unit}" data-index="${index}" data-field="unit" onchange="handleMasterEdit(this)" style="width: 95%;"></td>
                <td><input type="text" value="${item.size}" data-index="${index}" data-field="size" onchange="handleMasterEdit(this)" style="width: 95%;"></td>
                <td><input type="text" value="${item.textRemark}" data-index="${index}" data-field="textRemark" onchange="handleMasterEdit(this)" style="width: 95%;"></td>
                <td>${item.base64Image ? `<img src="${item.base64Image}" class="image-preview" title="ç‚¹å‡»ç§»é™¤å›¾ç‰‡" onclick="removeMasterImage(${index})">` : 'æ— '}</td>
                <td><button onclick="removeMasterItem(${index})" class="red">åˆ é™¤</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    function handleMasterEdit(input) {
        const index = parseInt(input.getAttribute('data-index'));
        const field = input.getAttribute('data-field');
        masterItems[index][field] = input.value;
    }

    function removeMasterImage(index) {
        if (confirm(`ç¡®å®šè¦ç§»é™¤ç‰©å“ ${masterItems[index].name} çš„å›¾ç‰‡å—ï¼Ÿ`)) {
            masterItems[index].base64Image = '';
            renderEditTable();
        }
    }

    function removeMasterItem(index) {
        if (confirm(`ç¡®å®šè¦ä»ç³»ç»Ÿä¸­ç§»é™¤ç‰©å“: ${masterItems[index].name} å—ï¼Ÿ`)) {
            masterItems.splice(index, 1);
            renderEditTable(); 
        }
    }

    function saveMasterItemsEdit() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(masterItems));
        alert("å·²å½•å…¥ç‰©å“åˆ—è¡¨ä¿å­˜æˆåŠŸï¼");
        closeMasterItemsModal();
        renderOrderTable();
    }

    // --- å®é™…è®¢è´§é¡µé¢åŠŸèƒ½ ---

    function renderOrderTable() {
        const tbody = document.getElementById('orderTableBody');
        tbody.innerHTML = ''; 

        orderList.forEach((row, index) => {
            const tr = document.createElement('tr');
            // ç¡®ä¿å›¾ç‰‡é¢„è§ˆåœ¨å•å…ƒæ ¼å†…å±…ä¸­
            const remarkContent = row.base64Image 
                ? `<div style="text-align: center;"><img src="${row.base64Image}" class="image-preview" style="max-width: 40px; max-height: 40px; display: inline-block;" title="${row.textRemark}"></div>` 
                : row.textRemark;
            
            // è°ƒæ•´è¾“å…¥æ¡†çš„æ ·å¼ä»¥é€‚åº”æ–°çš„ç®€æ´è¡¨æ ¼
            tr.innerHTML = `
                <td>${index + 1}.</td>
                <td class="autocomplete-container" style="text-align: left;">
                    <input type="text" value="${row.name || ''}" placeholder="è¾“å…¥ç‰©å“åç§°è‡ªåŠ¨è”æƒ³..." data-index="${index}" oninput="handleInput(this)" onfocus="handleInput(this)" onblur="setTimeout(() => document.getElementById('autocomplete-list-${index}').style.display='none', 200)" style="width: 95%; border: 1px solid #ccc; padding: 5px;">
                    <ul id="autocomplete-list-${index}" class="autocomplete-list" style="display: none;"></ul>
                </td>
                <td><input type="number" value="${row.qty || ''}" data-index="${index}" data-field="qty" oninput="handleOrderChange(this)" style="width: 80px; text-align: center; border: 1px solid #ccc; padding: 5px;"></td> 
                <td><input type="text" value="${row.unit || ''}" data-index="${index}" data-field="unit" onchange="handleOrderChange(this)" readonly style="background-color: #f7f7f7; border: none; text-align: center; width: 95%;"></td>
                <td><input type="text" value="${row.size || ''}" data-index="${index}" data-field="size" oninput="handleOrderChange(this)" style="width: 80px; text-align: center; border: 1px solid #ccc; padding: 5px;"></td>
                <td>${remarkContent}</td>
                <td><button onclick="removeRow(${index})" class="red" ${orderList.length === 1 ? 'disabled' : ''} style="padding: 5px 10px;">åˆ é™¤</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    function addRow() {
        orderList.push({ id: Date.now(), name: '', qty: '', unit: '', size: '', textRemark: '', base64Image: '' }); 
        renderOrderTable();
    }

    function removeRow(index) {
        if (orderList.length > 1 && confirm(`ç¡®å®šåˆ é™¤ç¬¬ ${index + 1} è¡Œç‰©å“: ${orderList[index].name || 'ç©ºè¡Œ'} å—ï¼Ÿ`)) {
            orderList.splice(index, 1);
            renderOrderTable();
        } else if (orderList.length === 1) {
            alert('è®¢è´§å•å¿…é¡»ä¿ç•™è‡³å°‘ä¸€è¡Œé¡¹ç›®ã€‚');
        }
    }

    function handleOrderChange(input) {
        const index = parseInt(input.getAttribute('data-index'));
        const field = input.getAttribute('data-field');
        orderList[index][field] = input.value;
    }

    function handleInput(input) {
        const val = input.value;
        const index = input.getAttribute('data-index');
        const listContainer = document.getElementById(`autocomplete-list-${index}`);
        listContainer.innerHTML = '';

        orderList[index].name = val; 

        if (!val) {
            listContainer.style.display = 'none';
            return;
        }

        const filteredItems = masterItems.filter(item => 
            item.name.toLowerCase().includes(val.toLowerCase())
        );

        if (filteredItems.length > 0) {
            listContainer.style.display = 'block';
            filteredItems.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item.name;
                li.onclick = () => selectItem(index, item);
                listContainer.appendChild(li);
            });
        } else {
            listContainer.style.display = 'none';
        }
    }

    function selectItem(index, item) {
        orderList[index].name = item.name;
        orderList[index].unit = item.unit;
        orderList[index].size = item.size;
        orderList[index].textRemark = item.textRemark;
        orderList[index].base64Image = item.base64Image;
        
        renderOrderTable();
    }
    
    // --- åŠŸèƒ½ï¼šä¸‹è½½å®Œæ•´ç‰©å“å¯¹ç…§è¡¨ (Word) ---
    function downloadMasterListAsWord() {
        if (masterItems.length === 0) {
            alert("ç‰©å“ç³»ç»Ÿä¸ºç©ºï¼Œæ— æ³•ä¸‹è½½ã€‚");
            return;
        }

        // Word æŠ¥è¡¨ä½¿ç”¨æ–°çš„æ·¡ç»¿è‰²è¡¨å¤´
        const wordHeaderBg = '#DCF2DE'; 

        let tableRowsHtml = masterItems.map((row, index) => {
             const rowColor = index % 2 === 0 ? '#F7FFF7' : 'white'; // ä¿æŒæ·¡ç»¿åŸºè°ƒ
             const imageHtml = row.base64Image 
                 ? `<div style="text-align: center;"><img src="${row.base64Image}" alt="Image" width="150" style="width: 150px; height: auto;"></div>`
                 : 'æ— å›¾ç‰‡';

             return `
                 <tr style="background-color: ${rowColor};">
                     <td style="border: 1px solid #444;">${index + 1}</td>
                     <td style="font-weight: bold; text-align: left; border: 1px solid #444;">${row.name}</td>
                     <td style="border: 1px solid #444;">${row.unit}</td>
                     <td style="border: 1px solid #444;">${row.size}</td>
                     <td style="text-align: left; border: 1px solid #444;">${row.textRemark}</td>
                     <td style="border: 1px solid #444;">${imageHtml}</td>
                 </tr>
             `;
        }).join('');

        const content = `
            <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head><meta charset='utf-8'><title>MASTER LIST</title>
            <style>
                body { font-family: 'Arial', sans-serif; }
                table { border-collapse: collapse; width: 100%; font-size: 10pt; }
                th, td { border: 1px solid #444; padding: 5px; text-align: center; vertical-align: middle; }
                th { background-color: ${wordHeaderBg}; font-weight: bold; color: #333; }
            </style>
            </head>
            <body>
                <h2 style="text-align: center;">ç‰©å“å¯¹ç…§è¡¨ / MASTER ITEM LIST</h2>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 5%;">åºå·</th>
                            <th style="width: 25%;">ç‰©å“åç§°</th>
                            <th style="width: 10%;">å•ä½</th>
                            <th style="width: 10%;">å¤§å°</th>
                            <th style="width: 20%;">å¤‡æ³¨</th>
                            <th style="width: 30%;">å›¾ç‰‡</th>
                        </tr>
                    </thead>
                    <tbody>${tableRowsHtml}</tbody>
                </table>
            </body></html>
        `;

        const blob = new Blob(['\ufeff', content], { type: 'application/msword;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `MICRON-MASTER-LIST-${new Date().toISOString().split('T')[0]}.doc`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // --- 4. ç”Ÿæˆè®¢è´§å• WORD (.doc) - æœ€ç»ˆä¼˜åŒ–ç‰ˆ (å·²æ›´æ–°ä¸ºæ¨ªå‘å¤§å›¾) ---

    function generateWord() {
        const requestDate = document.getElementById('requestDate').value;
        const deliveryDate = document.getElementById('deliveryDate').value; 

        if (!requestDate || !deliveryDate) {
            alert('è¯·å¡«å†™è®¢è´§æ—¥æœŸå’Œé€è´§æ—¥æœŸï¼');
            return;
        }

        const finalOrderList = orderList.filter(row => row.name && row.qty && row.qty.toString().trim() !== "");
        
        if (finalOrderList.length === 0) {
            alert("é”™è¯¯ï¼šæœªæ‰¾åˆ°æœ‰æ•ˆçš„è®¢è´§é¡¹ç›®ï¼è¯·ç¡®ä¿è‡³å°‘ä¸ºä¸€è¡Œå¡«å†™äº†â€œç‰©å“åç§°/è¯¦æƒ…â€å’Œâ€œQTY æ•°é‡â€ã€‚");
            return;
        }

        // Word æ ·å¼å˜é‡ (ä¸æ·¡ç»¿è‰²åŸºè°ƒåŒ¹é…)
        const wordHeaderBg = '#DCF2DE'; 
        const highlightStyle = 'color: #2E8B57; font-weight: bold;'; // æ·±ç»¿è‰²é«˜äº®

        let tableRowsHtml = finalOrderList.map((row, index) => {
            const rowColor = index % 2 === 0 ? '#F7FFF7' : 'white'; 
            
            // **ä¿®æ”¹ 1 & 2: å›ºå®šå›¾ç‰‡å°ºå¯¸ (180px) å’Œè°ƒæ•´è¡Œé«˜**
            const imageHtml = row.base64Image 
                ? `<div style="text-align: center; margin: 2px auto;"><img src="${row.base64Image}" alt="Image" width="180" height="150" style="width: 180px; height: 150px; display: block; margin: 0 auto; border: 1px solid #ccc; object-fit: contain;"></div>`
                : '';
            
            // **ä¿®æ”¹ 3: è®¾ç½®å›ºå®šè¡Œé«˜ (ä¿è¯ä¸€é¡µä¸‰è¡Œ)**
            const minRowHeight = '180px'; 

            return `
                <tr style="background-color: ${rowColor}; height: ${minRowHeight};">
                    <td style="width: 5%; padding: 3px; height: ${minRowHeight}; text-align: center; border: 1px solid #444;">${index + 1}.</td>
                    <td style="width: 25%; text-align: left; padding: 5px; font-weight: bold; font-size: 12pt; border: 1px solid #444;">${row.name}</td>
                    <td style="width: 10%; padding: 3px; text-align: center; border: 1px solid #444;">${row.qty}</td>
                    <td style="width: 10%; padding: 3px; text-align: center; border: 1px solid #444;">${row.unit}</td>
                    <td style="width: 10%; padding: 3px; text-align: center; border: 1px solid #444;">${row.size}</td>
                    <td style="width: 40%; text-align: center; padding: 3px; line-height: 1.1; border: 1px solid #444;">
                        ${row.textRemark ? `<span style="display: block; margin: 2px 0; font-size: 10pt;">${row.textRemark}</span>` : ''}
                        ${imageHtml}
                    </td>
                </tr>
            `;
        }).join('');

        const content = `
            <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head>
                <meta charset='utf-8'>
                <title>MICRON PROJECT ORDER</title>
                <style>
                    body { font-family: 'Arial', sans-serif; }
                    /* **ä¿®æ”¹ 4: è®¾ç½® A4 æ¨ªå‘ (Landscape) ** */
                    @page { size: 29.7cm 21.0cm; mso-page-orientation: landscape; margin: 1cm 1cm 1cm 1cm; } /* å‡å°é¡µè¾¹è· */
                    @page WordSection1 { size: 29.7cm 21.0cm; mso-page-orientation: landscape; margin: 1cm 1cm 1cm 1cm; }
                    div.WordSection1 { page: WordSection1; }
                    
                    .header-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 11pt; border: 1px solid #444; }
                    .header-table td { padding: 8px; border: 1px solid #ccc; background-color: #f7f7f7; }

                    .order-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 10pt; table-layout: fixed; }
                    .order-table th, .order-table td { border: 1px solid #444; padding: 3px; vertical-align: middle; } 
                    .order-table th { background-color: ${wordHeaderBg}; color: #333333; font-weight: bold; padding: 8px 3px; text-align: center; }
                </style>
            </head>
            <body>
            <div class="WordSection1">
                <p style="text-align: center; margin-bottom: 5px; font-size: 14pt;">MICRON | FAB</p>
                <h2 style="text-align: center; margin-top: 0; margin-bottom: 20px;">MICRON PROJECT è®¢è´§å•</h2>
                
                <table class="header-table">
                    <tr>
                        <td style="width: 50%;">REQUESTED BY è®¢è´§äºº: <span style="${highlightStyle}">${CONTACT_INFO.REQUESTED_BY}</span></td>
                        <td style="width: 50%;">CONTACT NO è”ç³»æ–¹å¼: <span style="${highlightStyle}">${CONTACT_INFO.CONTACT_NO}</span></td>
                    </tr>
                    <tr>
                        <td>REQUESTED DATE è®¢è´§æ—¥æœŸ: <span style="${highlightStyle}">${requestDate}</span></td>
                        <td>DELIVERY DATE é€è´§æ—¥æœŸ: <span style="${highlightStyle}">${deliveryDate}</span></td>
                    </tr>
                    <tr>
                        <td colspan="2">CONTACT PERSON è”ç³»äºº: <span style="${highlightStyle}">${CONTACT_INFO.REQUESTED_BY} ${CONTACT_INFO.CONTACT_NO}</span></td>
                    </tr>
                </table>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">ğŸ›’ è®¢è´§ç‰©å“åˆ—è¡¨ (è¯·åœ¨ Word ä¸­æŸ¥çœ‹å›¾ç‰‡)</h3>
                <table class="order-table">
                    <thead>
                        <tr>
                            <th style="width: 5%;">S/N åºå·</th>
                            <th style="width: 25%;">ITEMS/DESCRIPTION ç‰©å“/è¯¦æƒ…</th>
                            <th style="width: 10%;">QTY æ•°é‡</th>
                            <th style="width: 10%;">UNIT å•ä½</th>
                            <th style="width: 10%;">SIZE å¤§å°</th>
                            <th style="width: 40%;">REMARK è¯¦æƒ…ç…§ç‰‡</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRowsHtml}
                    </tbody>
                </table>
            </div>
            </body>
            </html>
        `;

        const blob = new Blob(['\ufeff', content], { type: 'application/msword;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `MICRON-ORDER-${requestDate}-L.doc`; // åŠ ä¸Š L æ ‡è¯†æ¨ªå‘
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    window.onload = init;
</script>
</body>
</html>